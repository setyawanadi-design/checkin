<!DOCTYPE html>
<html>
<head>
  <title>Surveyor App</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>

<h1>üìã Surveyor Check-In</h1>

<form id="checkInForm">
  <label>Name:</label><br>
  <input type="text" id="name" required><br><br>

  <label>Notes:</label><br>
  <input type="text" id="notes"><br><br>

  <button type="submit">Check In</button>
</form>

<h2>Today's Check-Ins</h2>

<table border="1" id="checkInTable">
  <thead>
    <tr>
      <th>Name</th>
      <th>Notes</th>
      <th>Time</th>
      <th>Location</th>
    </tr>
  </thead>
  <tbody>
    <!-- Rows go here -->
  </tbody>
</table>

<script>
  const CLIENT_ID = '452071405201-qd5dajju29v0mggmsqo2j0iov4f6audg.apps.googleusercontent.com';
  const API_KEY = 'AIzaSyBOV8cDq7fceHCigFuoCevPwRN9pG6riyI';
  const SHEET_ID = '1t0eXpsVfZL2ZEyc8N35pzrR7xQINkkhUvRekYki46bo';

  const form = document.getElementById('checkInForm');
  const table = document.getElementById('checkInTable').getElementsByTagName('tbody')[0];

  // Initialize Google API
  function initGoogleAPI() {
    gapi.client.init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      scope: 'https://www.googleapis.com/auth/spreadsheets',
      discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
    }).then(() => {
      console.log('‚úÖ Google API initialized!');
    }, (error) => {
      console.error('Failed to initialize Google API', error);
    });
  }

  gapi.load('client:auth2', initGoogleAPI);

  form.addEventListener('submit', function(event) {
    event.preventDefault();

    const name = document.getElementById('name').value;
    const notes = document.getElementById('notes').value;
    const now = new Date();
    const timeString = now.toLocaleString(); // Date + Time

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        const location = `Lat: ${latitude}, Lon: ${longitude}`;

        // Insert into local table
        const newRow = table.insertRow();
        newRow.insertCell(0).textContent = name;
        newRow.insertCell(1).textContent = notes;
        newRow.insertCell(2).textContent = timeString;
        newRow.insertCell(3).textContent = location;

        // Send to Google Sheets
        sendToGoogleSheets(name, notes, timeString, location);

        form.reset();
      }, function() {
        alert("Location access denied.");
      });
    } else {
      alert("Geolocation not supported by this browser.");
    }
  });

  function sendToGoogleSheets(name, notes, time, location) {
    gapi.client.sheets.spreadsheets.values.append({
      spreadsheetId: SHEET_ID,
      range: "Sheet1!A:D", // Make sure your Sheet is named 'Sheet1'
      valueInputOption: "RAW",
      insertDataOption: "INSERT_ROWS",
      resource: {
        values: [
          [name, notes, time, location]
        ]
      }
    }).then((response) => {
      console.log("‚úÖ Data submitted!", response);
      alert("‚úÖ Successfully submitted to Google Sheets!");
    }, (error) => {
      console.error("‚ùå Error submitting to Google Sheets", error);
      alert("‚ùå Failed to submit to Google Sheets");
    });
  }
</script>

</body>
</html>
