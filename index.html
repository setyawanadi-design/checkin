<!DOCTYPE html>
<html>
<head>
  <title>Surveyor App</title>
</head>
<body>

<h1>ðŸ“‹ Surveyor Check-In</h1>

<form id="checkInForm">
  <label>Name:</label><br>
  <input type="text" id="name" required><br><br>

  <label>Notes:</label><br>
  <input type="text" id="notes"><br><br>

  <button type="submit">Check In</button>
</form>

<h2>Today's Check-Ins</h2>

<table border="1" id="checkInTable">
  <thead>
    <tr>
      <th>Name</th>
      <th>Notes</th>
      <th>Time</th>
      <th>Location</th>
    </tr>
  </thead>
  <tbody>
    <!-- New rows will go here -->
  </tbody>
</table>

<script>
const form = document.getElementById('checkInForm');
const table = document.getElementById('checkInTable').getElementsByTagName('tbody')[0];

// Your Google Apps Script Web App URL
const webAppUrl = 'https://script.google.com/macros/s/AKfycbwhLkwTWpJDHd5hTC-j8mtJHNTyHjDR1UqATcR243c/exec';

form.addEventListener('submit', function(event) {
  event.preventDefault(); // Stop page refresh

  const name = document.getElementById('name').value;
  const notes = document.getElementById('notes').value;
  const now = new Date();
  const timeString = now.toLocaleTimeString();

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      const latitude = position.coords.latitude;
      const longitude = position.coords.longitude;
      const location = `Lat: ${latitude}, Lon: ${longitude}`;

      // Create new table row
      const newRow = table.insertRow();
      newRow.insertCell(0).textContent = name;
      newRow.insertCell(1).textContent = notes;
      newRow.insertCell(2).textContent = timeString;
      newRow.insertCell(3).textContent = location;

      // Send data to Google Sheets
      fetch(webAppUrl, {
        method: 'POST',
        mode: 'no-cors', // Important!
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name: name,
          notes: notes,
          time: timeString,
          location: location
        })
      })
      .then(response => {
        console.log('Submitted successfully!');
      })
      .catch(error => {
        console.error('Error!', error.message);
      });

      // Clear form
      form.reset();
    }, function() {
      alert("Location access denied. Can't check-in.");
    });
  } else {
    alert("Geolocation is not supported by this browser.");
  }
});
</script>

</body>
</html>
