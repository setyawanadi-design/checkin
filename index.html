<script>
  const form = document.getElementById('checkInForm');
  const table = document.getElementById('checkInTable').getElementsByTagName('tbody')[0];

  form.addEventListener('submit', function(event) {
    event.preventDefault(); // ðŸ›‘ Stop page refresh

    const name = document.getElementById('name').value;
    const notes = document.getElementById('notes').value;

    // Get current time
    const now = new Date();
    const timeString = now.toLocaleTimeString(); // Example: "14:23:45"

    // Check if location is available
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        const location = `Lat: ${latitude}, Lon: ${longitude}`;

        // Create new row in the table
        const newRow = table.insertRow();
        newRow.insertCell(0).textContent = name;
        newRow.insertCell(1).textContent = notes;
        newRow.insertCell(2).textContent = timeString;
        newRow.insertCell(3).textContent = location;

        // Send data to Google Sheets
        submitToGoogleSheets(name, notes, timeString, location);

        // Clear form
        form.reset();
      }, function() {
        alert("Location access denied.");
      });
    }
  });

  // Function to submit data to Google Sheets via Web App URL
  function submitToGoogleSheets(name, notes, time, location) {
    const url = 'https://script.google.com/macros/s/AKfycbzrUjZpnyF9dNVKV3usoyok8ubM5dzgsVwVR-R2cyeR43SvYiub6G2-HeFplJ_mlK0/exec'; // Web App URL

    const data = {
      name: name,
      notes: notes,
      time: time,
      location: location
    };

    // Sending data to the Web App via POST
    fetch(url, {
      method: 'POST',
      body: JSON.stringify(data),
      headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.text())
    .then(data => {
      console.log('Success:', data);
    })
    .catch((error) => {
      console.error('Error:', error);
    });
  }
</script>
