<!DOCTYPE html>
<html>
<head>
<script src="https://apis.google.com/js/api.js"></script>
  <title>Surveyor App</title>
</head>
<body>

  <h1>ðŸ“‹ Surveyor Check-In</h1>

  <form id="checkInForm">
    <label>Name:</label><br>
    <input type="text" id="name" required><br><br>

    <label>Notes:</label><br>
    <input type="text" id="notes"><br><br>

    <button type="submit">Check In</button>
  </form>

<h2>Today's Check-Ins</h2>

<table border="1" id="checkInTable">
<thead>
  <tr>
    <th>Name</th>
    <th>Notes</th>
    <th>Time</th>
    <th>Location</th>
  </tr>
</thead>

  <tbody>
    <!-- New rows will go here -->
  </tbody>
</table>

<script>
  const form = document.getElementById('checkInForm');
  const table = document.getElementById('checkInTable').getElementsByTagName('tbody')[0];

  const CLIENT_ID = '452071405201-qd5dajju29v0mggmsqo2j0iov4f6audg.apps.googleusercontent.com';
  const API_KEY = 'AIzaSyBOV8cDq7fceHCigFuoCevPwRN9pG6riyI';
  const SHEET_ID = '1t0eXpsVfZL2ZEyc8N35pzrR7xQINkkhUvRekYki46bo';

  function initGoogleAPI() {
    gapi.client.init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      scope: 'https://www.googleapis.com/auth/spreadsheets',
    }).then(function () {
      console.log('Google API initialized!');
    });
  }

  // Load Google API
  gapi.load('client:auth2', initGoogleAPI);

  form.addEventListener('submit', function(event) {
    event.preventDefault(); // Stop page refresh

    const name = document.getElementById('name').value;
    const notes = document.getElementById('notes').value;
    const now = new Date();
    const timeString = now.toLocaleTimeString(); // Current time

    let location = 'Not Available'; // Default location if geolocation fails

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        location = `Lat: ${latitude}, Lon: ${longitude}`; // Use actual location

        // Create a new row in the table
        const newRow = table.insertRow();
        newRow.insertCell(0).textContent = name;
        newRow.insertCell(1).textContent = notes;
        newRow.insertCell(2).textContent = timeString;
        newRow.insertCell(3).textContent = location;

        // Send data to Google Sheets
        sendToGoogleSheets(name, notes, timeString, location);

        // Reset the form
        form.reset();
      }, function() {
        alert("Location access denied.");
      });
    }
  });

  // Function to send data to Google Sheets
  function sendToGoogleSheets(name, notes, time, location) {
    const range = "Sheet1!A2:D2"; // Adjust this to the range where data should be inserted
    const values = [
      [name, notes, time, location]
    ];

    const body = {
      values: values
    };

    const params = {
      valueInputOption: "RAW"
    };

    const request = gapi.client.sheets.spreadsheets.values.append({
      spreadsheetId: SHEET_ID,
      range: range,
      valueInputOption: "RAW",
      resource: body
    });

    request.execute(function(response) {
      console.log('Data added to Google Sheets: ', response);
    });
  }
</script>

</body>
</html>
